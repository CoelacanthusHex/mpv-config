###########
# General #
###########

save-position-on-quit

# 高优先级
#priority=high

########
# 视频 #
########

# 指定要使用的视频输出后端。
vo=gpu-next,gpu
profile=gpu-hq

#hwdec=auto-copy
hwdec=auto

gpu-api=vulkan

vulkan-async-compute=yes
vulkan-async-transfer=yes

# may help with 4K videos
vd-lavc-dr=yes
opengl-pbo=yes

# "ReClock" replacement SVP补帧时推荐关闭
# 因为 Vulkan 的问题关闭
video-sync=display-resample

# smooth motion, SVP补帧时推荐关闭
interpolation

dither-depth=auto
temporal-dither
dither-size-fruit=7
# 默认6。会稍微延缓mpv启动
# 有兴趣也可以测试下error diffusion算法

# emmmmmm
deband=yes

# interpolation使用的算法。详见https://mpv.io/manual/master/#options-tscale
# 一些讨论见 https://github.com/mpv-player/mpv/issues/2685
# 目前的默认为mitchell。总体而言mitchell更平滑（当然不好和SVP插帧比），但会有模糊。oversample没有模糊，但不平滑（基本还原24帧的样子）
# 具体选择哪个请依据自身需求来
# SVP补帧时推荐关闭
tscale=oversample

# 放大算法，gpu-hq的默认为spline36
scale=ewa_lanczos
# 色度升频算法
cscale=ewa_lanczos
# 缩小算法
dscale=mitchell

# 启用校色
icc-profile-auto
# 默认64x64x64。会稍微延缓mpv启动
icc-3dlut-size=256x256x256
icc-cache-dir=/tmp/mpv-icc


#############
# 脚本 滤镜 #
#############

# 高级的cscale色度升频算法
#glsl-shaders-append="~~/shaders/igv/KrigBilateral.glsl"

# 在mpv.conf所在目录下建一个 shaders_cache 空文件夹，以存放编译好的GPU shaders，加速启动。
# 注意！如果不放APPDATA下，确保该文件夹有用户写入权限。
gpu-shader-cache-dir="~~/shaders_cache"


########
# 功能 #
########

# 如果你喜欢无边框的界面，你应该取消这行的前置注释#
#no-border
# 以暂停状态启动播放器
pause
# <N|inf|no> 始终循环播放当前文件
#loop=inf
# <N|inf|force|no>播放列表循环
#loop-playlist=no
# 播放完毕不退出
keep-open=yes
# 输出视频帧时请勿入睡。（开启后无法正确显示补帧数值）
#untimed
#log-file="~~desktop/mpv.log"


########
# 音频 #
########

#ao=pulse
ao=pipewire
# 音频通道独占
#audio-exclusive=yes
# <默认no|exact|fuzzy|all> 自动加载同名外挂音轨
audio-file-auto=fuzzy
# <100.0-1000.0>
#volume-max=100
# 播放器启动音量，0为静音
#volume=100

# 如果双声道系统播放多声道影片时有的声道声音没出现，尝试强制设定为双声道
#audio-channels=stereo
# 规格化：
#audio-normalize-downmix=yes
# 多声道音轨downmix成双声道时，如果觉得背景音过响，角色台词声音小，尝试看看这个：https://github.com/mpv-player/mpv/issues/6563

# Specify default audio device. You can list devices with: --audio-device=help
# The option takes the device string (the stuff between the '...').
#audio-device=alsa/default

# Do not filter audio to keep pitch when changing playback speed.
#audio-pitch-correction=no

# Output 5.1 audio natively, and upmix/downmix audio with a different format.
#audio-channels=5.1
# Disable any automatic remix, _if_ the audio output accepts the audio format.
# of the currently played file. See caveats mentioned in the manpage.
# (The default is "auto-safe", see manpage.)
#audio-channels=auto

########
# 字幕 #
########

# 自动加载同名外挂字幕
sub-auto=fuzzy
sub-file-paths=subs
# 字幕首选语言为(简体)中文
slang=chi,zh-CN,sc,chs,zh,eng,en,jp,jpn
alang=chi,zh-CN,sc,chs,zh,eng,en,jp,jpn
# <yes|video|默认no> 在插值和/或颜色管理之前，将字幕直接混合到升级的视频帧上（默认值：否）。 启用此选项会导致字幕受--icc-profile，--target-prim，--target-trc，--interpolation，--gamma-factor和--glsl-shaders的影响。 使用--interpolation时，还可以提高字幕性能。启用此功能的缺点是将字幕限制在视频的可见部分，因此，字幕不能出现在视频下方的黑色空白处（例如）。如果选择了video，则行为类似于yes，但是以视频的原始分辨率绘制了子对象，并与视频一起缩放。
blend-subtitles=video
# 使字幕输出在黑边上
sub-ass-force-margins=yes
#sid=1
# 字幕显示出来和xy-subfilter不一样？尝试启用下面的设置
# 关乎字幕是否随视频拉伸
#sub-ass-vsfilter-aspect-compat=no
# 关乎字幕模糊的设定
#sub-ass-vsfilter-blur-compat=no
# 即使都用上了也不一致？那不是这两个选项的问题，重新注释掉这两行，回帖问吧。（多半是vsfilter/libass其中一个的bug）

########
# 截图 #
########

# <默认jpg|png|webp>
screenshot-format=webp
# 默认为7（0-9）
#screenshot-png-compression=7
# 设置在PNG压缩之前应用的过滤器。0为无，1为sub，2为up，3为average，4为Paeth，5为mixed，这会影响可以达到的压缩级别。对于大多数图像，mixed可实现最佳压缩率，因此它是默认设置。
#screenshot-png-filter=5
screenshot-webp-lossless=yes
screenshot-webp-quality=100
screenshot-webp-compression=4 # 默认为4<0-6>
#screenshot-jpeg-quality=100
#screenshot-jpeg-source-chroma=yes
screenshot-tag-colorspace=yes
screenshot-high-bit-depth=yes
# s键保存路径截图在桌面
#screenshot-directory=~~desktop/


#######
# OSD #
#######

osc = no


##########
# Others #
##########

# Pretend to be a web browser. Might fix playback with some streaming sites,
# but also will break with shoutcast streams.
#user-agent="Mozilla/5.0"

# cache settings
#
# Use a large seekable RAM cache even for local input.
#cache=yes

cache=auto
# use max quality for HLS streams
hls-bitrate=max

#
# Use extra large RAM cache (needs cache=yes to make it useful).
#demuxer-max-bytes=500M
#demuxer-max-back-bytes=100M
#
# Disable the behavior that the player will pause if the cache goes below a
# certain fill size.
#cache-pause=no
#
# Store cache payload on the hard disk instead of in RAM. (This may negatively
# impact performance unless used for slow input such as network.)
#cache-dir=~/.cache/
#cache-on-disk=yes

# Display English subtitles if available.
#slang=en

# Play Finnish audio if available, fall back to English otherwise.
#alang=fi,en

# Change subtitle encoding. For Arabic subtitles use 'cp1256'.
# If the file seems to be valid UTF-8, prefer UTF-8.
# (You can add '+' in front of the codepage to force it.)
#sub-codepage=cp1256

ytdl=yes
#ytdl-format=(bestvideo[ext=webm]/bestvideo[height>1080]/bestvideo[fps=60])[tbr<13000]+(bestaudio[acodec=opus]/bestaudio[ext=webm]/bestaudio[acodec=vorbis]/bestaudio[acodec=aac]/bestaudio)/best
#ytdl-format=((bestvideo[vcodec^=vp9]/bestvideo)+(bestaudio[acodec=opus]/bestaudio[acodec=vorbis]/bestaudio[acodec=aac]/bestaudio))/best
ytdl-format="((bestvideo[height<=3840][vcodec^=vp9]/bestvideo[height<=3840])+(bestaudio[acodec=opus]/bestaudio[acodec=vorbis]/bestaudio[acodec=aac]/bestaudio))/best"
#ytdl-format=(bestvideo[height<=3840][vcodec=vp9]/bestvideo[height<=3840])+bestaudio
script-opts=ytdl_hook-ytdl_path=yt-dlp

# Colors!
msg-color=yes
msg-module=yes

############
# Profiles #
############

# The following profile can be enabled on the command line with: --profile=eye-cancer

# 根据视频是否是HDR以及视频aspect ratio决定是否启用blend-subtitles的profile
# 目前HDR->SDR建议关闭blend-subtitles，见https://github.com/mpv-player/mpv/issues/6368
# 如果hdr-compute-peak将来继续改进可能可以兼容blend-subtitles
[HDR_or_21:9]
profile-cond=p["video-params/primaries"]=="bt.2020" or p["video-params/aspect"]>=2.0
blend-subtitles=no
# 使字幕输出在黑边上
sub-ass-force-margins=yes

[SDR_and_16:9]
profile-cond=p["video-params/primaries"]~="bt.2020" and p["video-params/aspect"]<2.0
blend-subtitles=yes
sub-ass-force-margins=no
